<!--
 * @Author: lili11.yang
 * @Date: 2023-07-03 16:34:33
 * @Description: 
 * @LastEditTime: 2023-07-03 18:36:58
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        #map {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
        }
    </style>
    <script src="build/config.js"></script>
    <script src="build/three.min.js"></script>
    <script src="build/maptalks.min.js"></script>
</head>

<body>
    <div id="map"></div>
    <script>
        let map = "";
        let scene, camera, renderer;
        const width = window.innerWidth;
        const height = window.innerHeight;
        const aspect = width / height;

        // 初始化地图
        function initMap() {
            console.log("initMap");
            const baseLayerObj = {
                spatialReference: {
                    projection: "EPSG:3857",
                },
                urlTemplate: TDTileUrl,
                // 用于指定瓦片地图的子域名服务器
                subdomains: ["1", "2", "3", "4", "5"],
            };
            // 底图加载参数
            const mapObj = {
                zoom: 10,
                minZoom: 5,
                maxZoom: 19,
                center: [121.48, 31.24], // 中心经纬度
                pitch: 50, // 倾斜程度
                zIndex: layerZIndex.baseLayerZindex,
                // 天地图底图
                baseLayer: new maptalks.TileLayer("base", baseLayerObj),
                // 天地图添加注记图层
                layers: new maptalks.TileLayer("road", {
                    urlTemplate: TDRoadUrl,
                    subdomains: ["1", "2", "3", "4", "5"],
                    opacity: 1,
                }),
            };
            map = new maptalks.Map("map", mapObj);
            console.log('%c [ map ]-78', 'font-size:13px; background:pink; color:#bf2c9f;', map)
        }

        // threejs相关对象初始化
        function initThree() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, aspect, 0.1, 1000);
            camera.position.z = 100;
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(width, height);
            document.body.appendChild(renderer.domElement);
        }

        function createMesh() {
            //创建房屋模型
            var geometry = new THREE.BoxGeometry(50, 50, 50);
            var material = new THREE.MeshBasicMaterial({ color: 0x0000000 });
            var cube = new THREE.Mesh(geometry, material);

            //将房屋模型放置到地图上
            var x = 10; //房屋在地图上的x坐标
            var y = 10; //房屋在地图上的y坐标
            var z = 10; //房屋在three.js场景中的z坐标
            cube.position.copy(mapToScene(x, y));
            cube.position.z = z;
            scene.add(cube);
        }

        // 地图经纬度坐标与三维坐标转换
        function mapToScene(x, y) {
            // 将一个地图点转换为一个二维点 
            let pos = map.coordinateToPoint(new maptalks.Coordinate(x, y));
            return new THREE.Vector3(pos.x, pos.y, 0); // 三维
        }
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera)
        }
        window.onload = () => {
            initMap();
            initThree();
            createMesh();
            animate();
        }
    </script>
</body>

</html>